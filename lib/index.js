Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),n=require("zustand"),t=require("zustand/context");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=r(e),u=r(n),o=r(t),i=function(){return i=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var l in n=arguments[t])Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l]);return e},i.apply(this,arguments)};!function(e){if(!e||"undefined"==typeof window)return;const n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=e,document.head.appendChild(n)}(".form-bunch {\n  display: flex;\n  flex-wrap: wrap;\n}\n.form-bunch .form-bunch-item {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n}\n.form-bunch .form-bunch-item .form-bunch-item-require {\n  color: red;\n}\n.form-bunch .form-bunch-item .form-bunch-item-label {\n  line-height: 30px;\n  padding: 0 4px;\n  cursor: default;\n}\n.form-bunch .form-bunch-item .form-bunch-item-control {\n  padding: 0 4px;\n  text-align: left;\n}\n.form-bunch .form-bunch-item .form-bunch-item-tips {\n  text-align: left;\n  height: 24px;\n  flex: 100%;\n  display: flex;\n  padding: 4px;\n  color: rgba(0, 0, 0, 0.65);\n}\n.form-bunch .form-bunch-item .form-bunch-item-tips .form-bunch-item-error {\n  padding-left: 6px;\n  color: #e22e33;\n  font-size: 14px;\n}\n.form-bunch .form-bunch-item .form-bunch-item-noTips {\n  padding: 5px;\n  width: 100%;\n}\n\n/* form label align */\n.form-bunch-labelAlign-center {\n  text-align: center;\n}\n\n.form-bunch-labelAlign-right {\n  text-align: right;\n}\n\n.form-bunch-labelAlign-left {\n  text-align: left;\n}");var a,f=function(e){return null!=e&&("string"==typeof e?!!e:Array.isArray(e)?!!e.length:"object"!=typeof e||!!Object.keys({}).length)},c={"false-false":function(){return!0},"false-true":function(e,n,t){return(null==e?void 0:e.verify)instanceof RegExp?(null==e?void 0:e.verify).test(n)||!1:(null==e?void 0:e.verify)(n,t)||!1},"true-false":function(e,n){return f(n)},"true-true":function(e,n,t){if(f(n))return(null==e?void 0:e.verify)instanceof RegExp?(null==e?void 0:e.verify).test(n)||!1:(null==e?void 0:e.verify)(n,t)||!1;if("function"==typeof(null==e?void 0:e.verify)){var r=(null==e?void 0:e.verify)(n,t);return"string"==typeof r&&r}return!1}},s=function(e){var n,t,r=e.key,l=e.value,u=e.rule,o=e.initError,a=!!(null===(n=u[r])||void 0===n?void 0:n.required)+"-"+!!(null===(t=u[r])||void 0===t?void 0:t.verify),f=c[a](u[r],l[r],l);return i(i({},u[r]),{value:l[r],result:!0===f,error:"string"==typeof f?f:o[r]})},v=e.memo(e.forwardRef((function(n,t){var r=e.useState(null)[0],u=e.useRef(),o=m((function(e){return e.value})),i=m((function(e){return e.defaultValue})),a=m((function(e){return e.setInitRule})),f=m((function(e){return e.verify})),c=m((function(e){return e.verifyAll})),s=m((function(e){return e.reset})),v=e.useMemo((function(){for(var e={},t=0,r=n.items;t<r.length;t++){var l=r[t];e[l.key]=l.error||""}return e}),[n.items]),d=e.useMemo((function(){return function(e,n){var t={};return e.forEach((function(e){t[e.key]={value:n[e.key]||null,error:e.error||"",verify:null==e?void 0:e.verify,result:"unverified",required:!!(null==e?void 0:e.required)}})),t||{}}(n.items,i)}),[i,n.items]);e.useEffect((function(){a(d)}),[d]);var h=e.useCallback((function(e,n){return void 0===n&&(n=200),function(){var t=this;clearTimeout(r),r=setTimeout((function(){e.apply(t,arguments)}),n)}}),[]);return e.useImperativeHandle(t,(function(){return{validate:function(){return c({value:o||{},initError:v})},reset:function(){s()}}})),e.useEffect((function(){u.current?h((function(){f({value:o,initError:v})}))():u.current=!0}),[h,o,v]),l.default.createElement(l.default.Fragment,null)}))),d=(a=o.default()).Provider,m=a.useStore,h=function(){return u.default((function(e,n){return{value:{},initRule:{},rule:{},defaultValue:{},setValue:function(n){e({value:n})},verify:function(t){var r,l=t.value,u=t.initError,o=n().rule;for(var a in l)l.hasOwnProperty(a)&&(null===(r=o[a])||void 0===r?void 0:r.value)!==l[a]&&(o[a]=s({key:a,value:l,rule:o,initError:u}));e({rule:i({},o)})},verifyAll:function(t){var r=t.value,l=t.initError,u={},o=!0,i=n().rule;for(var a in i)i.hasOwnProperty(a)&&(u[a]=s({key:a,value:r,rule:i,initError:l}),o&&(o=Boolean(u[a].result)));return e({rule:u}),o},setInitRule:function(t){var r,l,u,o,a={},f=n().rule;for(var c in t)t.hasOwnProperty(c)&&(a[c]=i(i({},t[c]),{result:null!==(l=null===(r=f[c])||void 0===r?void 0:r.result)&&void 0!==l?l:t[c].result,value:null!==(o=null===(u=f[c])||void 0===u?void 0:u.value)&&void 0!==o?o:t[c].value}));e({rule:a,initRule:t})},setDefaultValue:function(n){e({value:n,defaultValue:n})},reset:function(){var t=n().rule,r=i({},t),l=n().defaultValue;for(var u in r)r.hasOwnProperty(u)&&(r[u].result="unverified",r[u].value=l[u]||"");e({rule:r,value:l})}}}))},y=function(e,n){return function(t){var r={};return n.onChange&&(r[n.onChange[0]]=function(e){if(n.onChange){for(var r=n.onChange[1].split("."),l=e,u=1;u<r.length;u++)l=l[r[u]];t.onChange(l)}}),n.value&&(r[n.value]=t.value),l.default.createElement(e,i({},t,r))}},b=function(e){var n,t={};for(n in e)e.hasOwnProperty(n)&&(e[n]instanceof Array?t[n]=y(e[n][0],e[n][1]):t[n]=e[n]);return t},p={input:[function(e){return l.default.createElement("input",i({},e))},{onChange:["onChange","e.target.value"]}]},g=b(p),C=e.memo((function(n){var t=m((function(e){return e.value})),r=m((function(e){return e.rule})),u=m((function(e){return e.setValue})),o=m((function(e){return e.setDefaultValue})),a=e.useRef(),f=e.useMemo((function(){return n.setting}),[n.setting]),c=e.useMemo((function(){return n.items}),[n.items]),s=e.useMemo((function(){var e={};return n.items.forEach((function(n){null!==n.defaultValue&&void 0!==n.defaultValue&&(e[n.key]=n.defaultValue)})),e}),[n.items]);e.useEffect((function(){a.current?u(n.value||{}):(o(i(i({},n.value),s)),a.current=!0)}),[n.value,s]);var v=e.useCallback((function(e,n){var t;return{item:{className:"form-bunch-item ".concat(e.className||"").trim(),style:{flexBasis:e.col||(null==f?void 0:f.col)||"100%",marginLeft:e.offset||(null==f?void 0:f.offset)||0}},label:{className:"form-bunch-item-label ".concat("form-bunch-labelAlign-"+(e.labelAlign||(null==f?void 0:f.labelAlign)||"right")),style:{flexBasis:String(e.labelCol||(null==f?void 0:f.labelCol)||"20%")}},control:{className:"form-bunch-item-control ".concat(n&&!1===(null===(t=n[e.key])||void 0===t?void 0:t.result)?"form-bunch-error-box":"").trim(),style:{flexBasis:String(e.labelCol||(null==f?void 0:f.labelCol)?e.controlCol||(null==f?void 0:f.controlCol)||"calc(100% - ".concat(e.labelCol||(null==f?void 0:f.labelCol),")"):e.controlCol||(null==f?void 0:f.controlCol)||"80%")}},tips1:{style:{flexBasis:String(e.labelCol||(null==f?void 0:f.labelCol)||"20%")}},tips2:{className:"form-bunch-item-error",style:{flexBasis:String(e.labelCol||(null==f?void 0:f.labelCol)?e.controlCol||(null==f?void 0:f.controlCol)||"calc(100% - ".concat(e.labelCol||(null==f?void 0:f.labelCol),")"):e.controlCol||(null==f?void 0:f.controlCol)||"80%")}}}}),[f]);return l.default.createElement("div",{className:"form-bunch ".concat(n.className||"").trim(),style:n.style},c.map((function(e){var o,a,c,s,d=g[e.type||""];return l.default.createElement("div",i({key:e.key},v(e).item),e.label&&l.default.createElement("div",i({},v(e).label),e.required&&l.default.createElement("span",{className:"form-bunch-item-require"},"*"),e.label),l.default.createElement("div",i({},(null===(o=v(e,r))||void 0===o?void 0:o.control)||{}),(null==e?void 0:e.type)?l.default.createElement(d,i({},e.typeProps||{},{value:t[e.key]||null,onChange:function(r){var l,o=i(i({},t),((l={})[e.key]=r,l));n.onChange(o,o[e.key],e.key),u(o)}})):e.render&&e.render(t[e.key],(function(r){var l,o=i(i({},t),((l={})[e.key]=r,l));n.onChange(o,o[e.key],e.key),u(o)}))||""),(null==f?void 0:f.hasTips)||(null===(a=r[e.key])||void 0===a?void 0:a.error)?l.default.createElement("div",{className:"form-bunch-item-tips"},e.label&&l.default.createElement("div",i({},v(e).tips1)),l.default.createElement("div",i({},v(e).tips2),!1===(null===(c=r[e.key])||void 0===c?void 0:c.result)&&(null===(s=r[e.key])||void 0===s?void 0:s.error))):l.default.createElement("div",{className:"form-bunch-item-noTips"}))})))})),x=e.forwardRef((function(n,t){var r=e.useRef();return e.useImperativeHandle(t,(function(){return{validate:function(){return r.current.validate()},reset:function(){return r.current.reset()}}})),l.default.createElement(d,{createStore:h},l.default.createElement(C,{className:n.className,style:n.style,value:n.value,setting:n.setting,items:n.items,onChange:function(e,t,r){n.onChange&&n.onChange(e,t,r)}}),l.default.createElement(v,{ref:r,items:n.items}))}));exports.computedExtensions=b(p);exports.formBunchInit=function(e){return exports.computedExtensions=b(e),x};
